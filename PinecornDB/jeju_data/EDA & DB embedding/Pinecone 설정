{"cells":[{"cell_type":"code","execution_count":1,"metadata":{"id":"o4RBC3C09RiU","executionInfo":{"status":"ok","timestamp":1733475848813,"user_tz":-540,"elapsed":541,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"outputs":[],"source":["import numpy as np\n","import pandas as pd"]},{"cell_type":"code","execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":18404,"status":"ok","timestamp":1733475867474,"user":{"displayName":"_강니","userId":"10023388957614741272"},"user_tz":-540},"id":"Q4H9SzS41mpR","outputId":"49db616c-1875-4969-9738-b842ec567db6"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","execution_count":3,"metadata":{"id":"bV_k9Y5j2NE5","executionInfo":{"status":"ok","timestamp":1733475867745,"user_tz":-540,"elapsed":276,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"outputs":[],"source":["path = '/content/drive/MyDrive/tamtam/qa_sets_by_theme.csv'\n","qa_sets_by_theme = pd.read_csv(path)"]},{"cell_type":"markdown","metadata":{"id":"6cAVUGT70e6B"},"source":["## Pinecone vector database 구현\n","- tamtam DB에 저장\n"]},{"cell_type":"markdown","metadata":{"id":"aKLQTJFN4STz"},"source":["### 1. JSON 변환"]},{"cell_type":"code","execution_count":4,"metadata":{"id":"lQiT3ewQ14Eu","executionInfo":{"status":"ok","timestamp":1733475870170,"user_tz":-540,"elapsed":2429,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"outputs":[],"source":["import json\n","from langchain.schema import Document  # Document 클래스 임포트"]},{"cell_type":"code","execution_count":5,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":310},"executionInfo":{"elapsed":26,"status":"ok","timestamp":1733475870173,"user":{"displayName":"_강니","userId":"10023388957614741272"},"user_tz":-540},"id":"KQ7BhvOX2T5G","outputId":"654809a5-d897-4ff9-f1aa-d8f7cb79431a"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["   Unnamed: 0 Theme                                 Question  \\\n","0           0    자연        자연 테마의 추천 관광지 신명지 주변의 음식점은 어디인가요?   \n","1           1    자연  자연 테마의 추천 관광지 동산물감귤체험농장 주변의 음식점은 어디인가요?   \n","2           2    자연        자연 테마의 추천 관광지 명월대 주변의 음식점은 어디인가요?   \n","3           3    자연        자연 테마의 추천 관광지 오현단 주변의 음식점은 어디인가요?   \n","4           4    자연        자연 테마의 추천 관광지 해신사 주변의 음식점은 어디인가요?   \n","\n","                                              Answer  \n","0  [{\"Restaurant_Name\": \"영국찻집\", \"Address\": \"제주특별자...  \n","1  [{\"Restaurant_Name\": \"머클랑정육식당\", \"Address\": \"제주...  \n","2  [{\"Restaurant_Name\": \"명월리마을회\", \"Address\": \"제주특...  \n","3  [{\"Restaurant_Name\": \"잘도식당\", \"Address\": \"제주특별자...  \n","4  [{\"Restaurant_Name\": \"진푸드\", \"Address\": \"제주특별자치...  "],"text/html":["\n","  <div id=\"df-1b6aba0a-a2f6-4459-82b8-b5f3a25ac8ac\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>Unnamed: 0</th>\n","      <th>Theme</th>\n","      <th>Question</th>\n","      <th>Answer</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0</td>\n","      <td>자연</td>\n","      <td>자연 테마의 추천 관광지 신명지 주변의 음식점은 어디인가요?</td>\n","      <td>[{\"Restaurant_Name\": \"영국찻집\", \"Address\": \"제주특별자...</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>1</td>\n","      <td>자연</td>\n","      <td>자연 테마의 추천 관광지 동산물감귤체험농장 주변의 음식점은 어디인가요?</td>\n","      <td>[{\"Restaurant_Name\": \"머클랑정육식당\", \"Address\": \"제주...</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>2</td>\n","      <td>자연</td>\n","      <td>자연 테마의 추천 관광지 명월대 주변의 음식점은 어디인가요?</td>\n","      <td>[{\"Restaurant_Name\": \"명월리마을회\", \"Address\": \"제주특...</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>3</td>\n","      <td>자연</td>\n","      <td>자연 테마의 추천 관광지 오현단 주변의 음식점은 어디인가요?</td>\n","      <td>[{\"Restaurant_Name\": \"잘도식당\", \"Address\": \"제주특별자...</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>4</td>\n","      <td>자연</td>\n","      <td>자연 테마의 추천 관광지 해신사 주변의 음식점은 어디인가요?</td>\n","      <td>[{\"Restaurant_Name\": \"진푸드\", \"Address\": \"제주특별자치...</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-1b6aba0a-a2f6-4459-82b8-b5f3a25ac8ac')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-1b6aba0a-a2f6-4459-82b8-b5f3a25ac8ac button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-1b6aba0a-a2f6-4459-82b8-b5f3a25ac8ac');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-1c1b5e4c-c898-4df6-b902-d76326be622a\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-1c1b5e4c-c898-4df6-b902-d76326be622a')\"\n","            title=\"Suggest charts\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const quickchartButtonEl =\n","        document.querySelector('#' + key + ' button');\n","      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","      quickchartButtonEl.classList.add('colab-df-spinner');\n","      try {\n","        const charts = await google.colab.kernel.invokeFunction(\n","            'suggestCharts', [key], {});\n","      } catch (error) {\n","        console.error('Error during call to suggestCharts:', error);\n","      }\n","      quickchartButtonEl.classList.remove('colab-df-spinner');\n","      quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-1c1b5e4c-c898-4df6-b902-d76326be622a button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","variable_name":"qa_sets_by_theme","summary":"{\n  \"name\": \"qa_sets_by_theme\",\n  \"rows\": 852,\n  \"fields\": [\n    {\n      \"column\": \"Unnamed: 0\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": 246,\n        \"min\": 0,\n        \"max\": 851,\n        \"num_unique_values\": 852,\n        \"samples\": [\n          66,\n          434,\n          198\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"Theme\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 5,\n        \"samples\": [\n          \"\\uc561\\ud2f0\\ube44\\ud2f0\",\n          \"\\ubb38\\ud654/\\uc608\\uc220/\\uc5ed\\uc0ac\",\n          \"\\uc1fc\\ud551\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"Question\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 819,\n        \"samples\": [\n          \"\\uc790\\uc5f0 \\ud14c\\ub9c8\\uc758 \\ucd94\\ucc9c \\uad00\\uad11\\uc9c0 \\ucc9c\\uc81c\\uc5f0\\ub09c\\ub300\\ub9bc\\uc9c0\\ub300 \\uc8fc\\ubcc0\\uc758 \\uc74c\\uc2dd\\uc810\\uc740 \\uc5b4\\ub514\\uc778\\uac00\\uc694?\",\n          \"\\uc1fc\\ud551 \\ud14c\\ub9c8\\uc758 \\ucd94\\ucc9c \\uad00\\uad11\\uc9c0 \\ub0a8\\uc218\\uac01\\ud558\\ub298\\uae38\\ubcbd\\ud654\\uac70\\ub9ac \\uc8fc\\ubcc0\\uc758 \\uc74c\\uc2dd\\uc810\\uc740 \\uc5b4\\ub514\\uc778\\uac00\\uc694?\",\n          \"\\ubb38\\ud654/\\uc608\\uc220/\\uc5ed\\uc0ac \\ud14c\\ub9c8\\uc758 \\ucd94\\ucc9c \\uad00\\uad11\\uc9c0 \\uc0c1\\uac00\\ub9ac\\uc57c\\uc790\\uc232 \\uc8fc\\ubcc0\\uc758 \\uc74c\\uc2dd\\uc810\\uc740 \\uc5b4\\ub514\\uc778\\uac00\\uc694?\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"Answer\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 720,\n        \"samples\": [\n          \"[{\\\"Restaurant_Name\\\": \\\"\\ubbf8\\ub4dc\\ub098\\uc787\\uc368\\ub2c8\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc81c\\uc8fc\\uc2dc \\uc6a9\\ub2f4\\ub85c 125, 1\\uce35 (\\uc6a9\\ub2f4\\uc77c\\ub3d9)\\\"}, {\\\"Restaurant_Name\\\": \\\"\\uc21c\\uc790\\uc18c\\uc8fc\\ubc29\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc81c\\uc8fc\\uc2dc \\uc6a9\\ub2f4\\ub85c 115 (\\uc6a9\\ub2f4\\uc77c\\ub3d9)\\\"}, {\\\"Restaurant_Name\\\": \\\"\\uc6a9\\ub2f4\\ub85c\\ud0c0\\ub9ac\\ud3ec\\uc7a5\\ub9c8\\ucc28\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc81c\\uc8fc\\uc2dc \\uc6a9\\ub2f4\\ub85c 115 (\\uc6a9\\ub2f4\\uc77c\\ub3d9)\\\"}, {\\\"Restaurant_Name\\\": \\\"\\uc885\\ub85c\\ube48\\ub300\\ub5a1\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc81c\\uc8fc\\uc2dc \\uc6a9\\ub2f4\\ub85c 122, 1\\uce35 (\\uc6a9\\ub2f4\\uc77c\\ub3d9)\\\"}, {\\\"Restaurant_Name\\\": \\\"\\uc885\\uc810\\uc5ed\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc81c\\uc8fc\\uc2dc \\uc11c\\ubb38\\ub85c 24-3, 1\\uce35 (\\uc6a9\\ub2f4\\uc77c\\ub3d9)\\\"}]\",\n          \"[{\\\"Restaurant_Name\\\": \\\"\\uc5b4\\ub77c\\uc6b4\\ub4dc\\ud3f4\\ub9ac\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc11c\\uadc0\\ud3ec\\uc2dc \\uc131\\uc0b0\\uc74d \\uc11c\\uc131\\uc77c\\ub85c 431\\\"}, {\\\"Restaurant_Name\\\": \\\"\\ud50c\\ub85c\\ub9ac\\uc548\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc11c\\uadc0\\ud3ec\\uc2dc \\uc131\\uc0b0\\uc74d \\uc11c\\uc131\\uc77c\\ub85c 474\\\"}, {\\\"Restaurant_Name\\\": \\\"\\ubca0\\ub124\\uc2dc\\uc548\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc11c\\uadc0\\ud3ec\\uc2dc \\uc131\\uc0b0\\uc74d \\uc11c\\uc131\\uc77c\\ub85c 474, 1\\uce35\\\"}, {\\\"Restaurant_Name\\\": \\\"\\ud314\\ubbf8\\ub3c8\\uac00\\ud751\\ub3fc\\uc9c0\\uc131\\uc0b0\\uc810\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc11c\\uadc0\\ud3ec\\uc2dc \\uc131\\uc0b0\\uc74d \\uc11c\\uc131\\uc77c\\ub85c 511, 1\\uce35\\\"}, {\\\"Restaurant_Name\\\": \\\"\\uc544\\uc784\\ub9c8\\uc6b4\\ud2f4\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc11c\\uadc0\\ud3ec\\uc2dc \\uc131\\uc0b0\\uc74d \\uc11c\\uc131\\uc77c\\ub85c 510\\\"}]\",\n          \"[{\\\"Restaurant_Name\\\": \\\"\\ucd94\\ub9c9\\ud68c\\uc564\\uce74\\ud398\\ud790\\uc2a4\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc81c\\uc8fc\\uc2dc \\ucd94\\uc790\\uba74 \\uc2e0\\uc5914\\uae38 18, \\uc9c0\\ud5581\\uce35\\\"}, {\\\"Restaurant_Name\\\": \\\"\\uc720\\uc2a4\\ud14c\\uc774\\ucd94\\uc790\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc81c\\uc8fc\\uc2dc \\ucd94\\uc790\\uba74 \\uc2e0\\uc5912\\uae38 28-12\\\"}, {\\\"Restaurant_Name\\\": \\\"\\ub808\\ubaac\\uc774\\ub124\\uc2dd\\ub2f9\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc81c\\uc8fc\\uc2dc \\ucd94\\uc790\\uba74 \\ucd94\\uc790\\ub85c 583, \\uac00\\ub3d9 \\uc9c0\\ud5581\\uce35\\\"}, {\\\"Restaurant_Name\\\": \\\"\\uace0\\ud5a5\\ud5a5\\ud1a0\\uc7a5\\ud130\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc81c\\uc8fc\\uc2dc \\ucd94\\uc790\\uba74 \\ucd94\\uc790\\ub85c 576, \\uc2e0\\uc591\\uc5b4\\ucd0c\\uacc4 1\\uce35\\\"}, {\\\"Restaurant_Name\\\": \\\"\\uc5d0\\ucf54\\ud478\\ub4dc\\ud2b8\\ub7ed\\\", \\\"Address\\\": \\\"\\uc81c\\uc8fc\\ud2b9\\ubcc4\\uc790\\uce58\\ub3c4 \\uc81c\\uc8fc\\uc2dc \\ucd94\\uc790\\uba74 \\ucd94\\uc790\\ub85c 657\\\"}]\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"}},"metadata":{},"execution_count":5}],"source":["qa_sets_by_theme.head()"]},{"cell_type":"code","execution_count":6,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":21,"status":"ok","timestamp":1733475870174,"user":{"displayName":"_강니","userId":"10023388957614741272"},"user_tz":-540},"id":"_jZnzxwu2cEz","outputId":"a8799407-967c-42cb-f31a-d015b617c6e1"},"outputs":[{"output_type":"stream","name":"stdout","text":["JSON 파일로 저장 완료: QA_set.json\n"]}],"source":["# JSON 변환\n","json_file = \"QA_set.json\"\n","qa_sets_by_theme.to_json(json_file, orient=\"records\", force_ascii=False, indent=4)\n","\n","print(f\"JSON 파일로 저장 완료: {json_file}\")"]},{"cell_type":"code","execution_count":7,"metadata":{"id":"kvms-eho2pDn","executionInfo":{"status":"ok","timestamp":1733475870174,"user_tz":-540,"elapsed":15,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"outputs":[],"source":["# JSON 변환: 질문별로 관련 음식점을 포함\n","json_data = []\n","for _, row in qa_sets_by_theme.iterrows():\n","    answer_list = json.loads(row['Answer'])  # Answer가 JSON 문자열인 경우\n","    json_data.append({\n","        \"question\": row[\"Question\"],\n","        \"theme\": row[\"Theme\"],\n","        \"location\": row[\"Question\"].split(\" 주변의\")[0].split()[-1],  # 질문에서 관광지 추출\n","        \"restaurants\": answer_list  # 음식점 리스트 추가\n","    })"]},{"cell_type":"code","execution_count":8,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":359,"status":"ok","timestamp":1733475870519,"user":{"displayName":"_강니","userId":"10023388957614741272"},"user_tz":-540},"id":"0WVVAV2d2hrK","outputId":"975d2f19-f8f8-4bc4-a1e9-ec7456d3fdc6"},"outputs":[{"output_type":"stream","name":"stdout","text":["JSON 파일 저장 완료: QA_with_restaurants.json\n"]}],"source":["# JSON 파일 저장\n","json_file = \"QA_with_restaurants.json\"\n","with open(json_file, \"w\", encoding=\"utf-8\") as f:\n","    json.dump(json_data, f, ensure_ascii=False, indent=4)\n","\n","print(f\"JSON 파일 저장 완료: {json_file}\")"]},{"cell_type":"code","execution_count":9,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":33,"status":"ok","timestamp":1733475870520,"user":{"displayName":"_강니","userId":"10023388957614741272"},"user_tz":-540},"id":"EGPyPpXm27lc","outputId":"84611fe3-9a7e-48e5-cd4c-c62d7e858828"},"outputs":[{"output_type":"stream","name":"stdout","text":["[\n","    {\n","        \"question\": \"자연 테마의 추천 관광지 신명지 주변의 음식점은 어디인가요?\",\n","        \"theme\": \"자연\",\n","        \"location\": \"신명지\",\n","        \"restaurants\": [\n","            {\n","                \"Restaurant_Name\": \"영국찻집\",\n","                \"Address\": \"제주특별자치도 제주시 애월읍 녹근로 19-15, 1층\"\n","            },\n","            {\n","                \"Restaurant_Name\": \"소이네김밥\",\n","                \"Address\": \"제주특별자치도 제주시 애월읍 봉성로 64\"\n","            },\n","            {\n","                \"Restaurant_Name\": \"봉성식당\",\n","                \"Address\": \"제주특별자치도 제주시 애월읍 봉성로 66, 1층\"\n","            },\n","            {\n","                \"Restaurant_Name\": \"봉성이모식당\",\n","                \"Address\": \"제주특별자치도 제주시 애월읍 녹근로 9, 1층\"\n","            },\n","            {\n","                \"Restaurant_Name\": \"제주들녘\",\n","                \"Address\": \"제주특별자치도 제주시 애월읍 녹근로 13-1, 1층\"\n","            }\n","        ]\n","    },\n","    {\n","        \"question\": \"자연 테마의 추천 관광지 동산물감귤체험농장 주변의 음식점은 어디인가요?\",\n","        \"theme\": \"자연\",\n","        \"location\": \"동산물감귤체험농장\",\n","        \"restaurants\": [\n","            {\n","                \"Restaurant_Name\": \"머클랑정육식당\",\n","                \"Address\": \"제주특별자치도 서귀포시 성산읍 서성일로 786\"\n","            },\n","            {\n","                \"Restaurant_Name\": \"술의길\",\n","                \"Address\": \"제주특별자치도 서귀포시 성산읍 서성일로 783, 가동 1층\"\n","            },\n","            {\n","                \"Restaurant_Name\": \"카페미누\",\n","                \"Address\": \"제주특별자치도 서귀포시 성산읍 금백조로 66\"\n","            },\n","            {\n","                \"Restaurant_Name\": \"그때그맛\",\n","                \"Address\": \"제주특별자치도 서귀포시 성산읍 금백조로 70, 1층\"\n","            },\n","            {\n","                \"Restaurant_Name\": \"카페바르\",\n","                \"Address\": \"제주특별자치도 서귀포시 성산읍 금백조로 87\"\n","            }\n","        ]\n","    },\n","    {\n","        \"question\": \"자연 테마의 추천 관광지 명월대 주변의 음식점은 어디인가요?\",\n","        \"theme\": \"자연\",\n","        \"location\": \"명월대\",\n","        \"restaurants\": [\n","            {\n","                \"Restaurant_Name\": \"명월리마을회\",\n","                \"Address\": \"제주특별자치도 제주시 한림읍 명월로 48, 1층\"\n","            },\n","            {\n","                \"Restaurant_Name\": \"돌연히\",\n","                \"Address\": \"제주특별자치도 제주시 한림읍 명월로2길 6, 1층\"\n","            },\n","            {\n","                \"Restaurant_Name\": \"사브와\",\n","                \"Address\": \"제주특별자치도 제주시 한림읍 명월로 79, 1층\"\n","            },\n","            {\n","                \"Restaurant_Name\": \"돌나무바람그리고담\",\n","                \"Address\": \"제주특별자치도 제주시 한림읍 명월로 83-1, 1층\"\n","            },\n","            {\n","                \"Restaurant_Name\": \"카페귤한가\",\n","                \"Address\": \"제주특별자치도 제주시 한림읍 명월성로 238-1, 1층\"\n","            }\n","        ]\n","    }\n","]\n"]}],"source":["# JSON 파일 로드\n","with open(\"QA_with_restaurants.json\", \"r\", encoding=\"utf-8\") as f:\n","    data = json.load(f)\n","\n","# 샘플 데이터 확인\n","print(json.dumps(data[:3], ensure_ascii=False, indent=4))"]},{"cell_type":"code","execution_count":10,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":27,"status":"ok","timestamp":1733475870520,"user":{"displayName":"_강니","userId":"10023388957614741272"},"user_tz":-540},"id":"HCOwMzdC5dX3","outputId":"b3d660ee-3680-4673-a64c-56131107c996"},"outputs":[{"output_type":"stream","name":"stdout","text":["JSON 데이터 로드 완료: 852 개의 QA 세트\n"]}],"source":["# JSON 파일 로드\n","json_file = \"QA_with_restaurants.json\"\n","with open(json_file, \"r\", encoding=\"utf-8\") as f:\n","    qa_data = json.load(f)\n","\n","print(f\"JSON 데이터 로드 완료: {len(qa_data)} 개의 QA 세트\")\n"]},{"cell_type":"code","source":["from langchain.schema import Document\n","\n","# JSON 데이터를 Document 객체로 변환\n","documents = [\n","    Document(\n","        page_content=record[\"question\"],\n","        metadata={\n","            \"theme\": record[\"theme\"],\n","            \"location\": record[\"location\"],\n","            \"restaurants\": record[\"restaurants\"]\n","        }\n","    )\n","    for record in qa_data\n","]\n","\n","print(f\"Document 객체 생성 완료: {len(documents)} 개의 문서\")\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"eYnD20EpgQxq","executionInfo":{"status":"ok","timestamp":1733475870521,"user_tz":-540,"elapsed":19,"user":{"displayName":"_강니","userId":"10023388957614741272"}},"outputId":"e9b044e2-3724-4b5b-8ab3-8cd84c80b9c3"},"execution_count":11,"outputs":[{"output_type":"stream","name":"stdout","text":["Document 객체 생성 완료: 852 개의 문서\n"]}]},{"cell_type":"markdown","metadata":{"id":"RO-Jvm3k3mxy"},"source":["###2. langchain 연결\n","###### LangChain의 커뮤니티 확장 기능\n","######LangChain과 Pinecone을 통합\n","- 데이터를 Pinecone에 업로드\n","- Pinecone에서 유사도 검색 수행.\n","- LangChain 워크플로우와 Pinecone의 강력한 검색\n","엔진을 함께 사용."]},{"cell_type":"code","execution_count":12,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":28249,"status":"ok","timestamp":1733475898757,"user":{"displayName":"_강니","userId":"10023388957614741272"},"user_tz":-540},"id":"hKApaMMW5fAE","outputId":"2465cc15-59cf-4327-c072-9322f82b5d11"},"outputs":[{"output_type":"stream","name":"stdout","text":["Collecting langchain_community\n","  Downloading langchain_community-0.3.9-py3-none-any.whl.metadata (2.9 kB)\n","Collecting langchain_pinecone\n","  Downloading langchain_pinecone-0.2.0-py3-none-any.whl.metadata (1.7 kB)\n","Collecting langchain_openai\n","  Downloading langchain_openai-0.2.11-py3-none-any.whl.metadata (2.7 kB)\n","Collecting unstructured\n","  Downloading unstructured-0.16.9-py3-none-any.whl.metadata (24 kB)\n","Requirement already satisfied: langchain-text-splitters in /usr/local/lib/python3.10/dist-packages (0.3.2)\n","Requirement already satisfied: PyYAML>=5.3 in /usr/local/lib/python3.10/dist-packages (from langchain_community) (6.0.2)\n","Requirement already satisfied: SQLAlchemy<3,>=1.4 in /usr/local/lib/python3.10/dist-packages (from langchain_community) (2.0.36)\n","Requirement already satisfied: aiohttp<4.0.0,>=3.8.3 in /usr/local/lib/python3.10/dist-packages (from langchain_community) (3.11.9)\n","Collecting dataclasses-json<0.7,>=0.5.7 (from langchain_community)\n","  Downloading dataclasses_json-0.6.7-py3-none-any.whl.metadata (25 kB)\n","Collecting httpx-sse<0.5.0,>=0.4.0 (from langchain_community)\n","  Downloading httpx_sse-0.4.0-py3-none-any.whl.metadata (9.0 kB)\n","Requirement already satisfied: langchain<0.4.0,>=0.3.8 in /usr/local/lib/python3.10/dist-packages (from langchain_community) (0.3.9)\n","Requirement already satisfied: langchain-core<0.4.0,>=0.3.21 in /usr/local/lib/python3.10/dist-packages (from langchain_community) (0.3.21)\n","Requirement already satisfied: langsmith<0.2.0,>=0.1.125 in /usr/local/lib/python3.10/dist-packages (from langchain_community) (0.1.147)\n","Requirement already satisfied: numpy<2,>=1.22.4 in /usr/local/lib/python3.10/dist-packages (from langchain_community) (1.26.4)\n","Collecting pydantic-settings<3.0.0,>=2.4.0 (from langchain_community)\n","  Downloading pydantic_settings-2.6.1-py3-none-any.whl.metadata (3.5 kB)\n","Requirement already satisfied: requests<3,>=2 in /usr/local/lib/python3.10/dist-packages (from langchain_community) (2.32.3)\n","Requirement already satisfied: tenacity!=8.4.0,<10,>=8.1.0 in /usr/local/lib/python3.10/dist-packages (from langchain_community) (9.0.0)\n","Collecting aiohttp<4.0.0,>=3.8.3 (from langchain_community)\n","  Downloading aiohttp-3.9.5-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (7.5 kB)\n","Collecting pinecone-client<6.0.0,>=5.0.0 (from langchain_pinecone)\n","  Downloading pinecone_client-5.0.1-py3-none-any.whl.metadata (19 kB)\n","Requirement already satisfied: openai<2.0.0,>=1.54.0 in /usr/local/lib/python3.10/dist-packages (from langchain_openai) (1.54.5)\n","Collecting tiktoken<1,>=0.7 (from langchain_openai)\n","  Downloading tiktoken-0.8.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (6.6 kB)\n","Requirement already satisfied: chardet in /usr/local/lib/python3.10/dist-packages (from unstructured) (5.2.0)\n","Collecting filetype (from unstructured)\n","  Downloading filetype-1.2.0-py2.py3-none-any.whl.metadata (6.5 kB)\n","Collecting python-magic (from unstructured)\n","  Downloading python_magic-0.4.27-py2.py3-none-any.whl.metadata (5.8 kB)\n","Requirement already satisfied: lxml in /usr/local/lib/python3.10/dist-packages (from unstructured) (5.3.0)\n","Requirement already satisfied: nltk in /usr/local/lib/python3.10/dist-packages (from unstructured) (3.9.1)\n","Requirement already satisfied: beautifulsoup4 in /usr/local/lib/python3.10/dist-packages (from unstructured) (4.12.3)\n","Collecting emoji (from unstructured)\n","  Downloading emoji-2.14.0-py3-none-any.whl.metadata (5.7 kB)\n","Collecting python-iso639 (from unstructured)\n","  Downloading python_iso639-2024.10.22-py3-none-any.whl.metadata (13 kB)\n","Collecting langdetect (from unstructured)\n","  Downloading langdetect-1.0.9.tar.gz (981 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m981.5/981.5 kB\u001b[0m \u001b[31m2.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25h  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Collecting rapidfuzz (from unstructured)\n","  Downloading rapidfuzz-3.10.1-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (11 kB)\n","Collecting backoff (from unstructured)\n","  Downloading backoff-2.2.1-py3-none-any.whl.metadata (14 kB)\n","Requirement already satisfied: typing-extensions in /usr/local/lib/python3.10/dist-packages (from unstructured) (4.12.2)\n","Collecting unstructured-client (from unstructured)\n","  Downloading unstructured_client-0.28.1-py3-none-any.whl.metadata (20 kB)\n","Requirement already satisfied: wrapt in /usr/local/lib/python3.10/dist-packages (from unstructured) (1.17.0)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.10/dist-packages (from unstructured) (4.66.6)\n","Requirement already satisfied: psutil in /usr/local/lib/python3.10/dist-packages (from unstructured) (5.9.5)\n","Collecting python-oxmsg (from unstructured)\n","  Downloading python_oxmsg-0.0.1-py3-none-any.whl.metadata (5.0 kB)\n","Requirement already satisfied: html5lib in /usr/local/lib/python3.10/dist-packages (from unstructured) (1.1)\n","Requirement already satisfied: aiosignal>=1.1.2 in /usr/local/lib/python3.10/dist-packages (from aiohttp<4.0.0,>=3.8.3->langchain_community) (1.3.1)\n","Requirement already satisfied: attrs>=17.3.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp<4.0.0,>=3.8.3->langchain_community) (24.2.0)\n","Requirement already satisfied: frozenlist>=1.1.1 in /usr/local/lib/python3.10/dist-packages (from aiohttp<4.0.0,>=3.8.3->langchain_community) (1.5.0)\n","Requirement already satisfied: multidict<7.0,>=4.5 in /usr/local/lib/python3.10/dist-packages (from aiohttp<4.0.0,>=3.8.3->langchain_community) (6.1.0)\n","Requirement already satisfied: yarl<2.0,>=1.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp<4.0.0,>=3.8.3->langchain_community) (1.18.3)\n","Requirement already satisfied: async-timeout<5.0,>=4.0 in /usr/local/lib/python3.10/dist-packages (from aiohttp<4.0.0,>=3.8.3->langchain_community) (4.0.3)\n","Collecting marshmallow<4.0.0,>=3.18.0 (from dataclasses-json<0.7,>=0.5.7->langchain_community)\n","  Downloading marshmallow-3.23.1-py3-none-any.whl.metadata (7.5 kB)\n","Collecting typing-inspect<1,>=0.4.0 (from dataclasses-json<0.7,>=0.5.7->langchain_community)\n","  Downloading typing_inspect-0.9.0-py3-none-any.whl.metadata (1.5 kB)\n","Requirement already satisfied: pydantic<3.0.0,>=2.7.4 in /usr/local/lib/python3.10/dist-packages (from langchain<0.4.0,>=0.3.8->langchain_community) (2.10.2)\n","Requirement already satisfied: jsonpatch<2.0,>=1.33 in /usr/local/lib/python3.10/dist-packages (from langchain-core<0.4.0,>=0.3.21->langchain_community) (1.33)\n","Requirement already satisfied: packaging<25,>=23.2 in /usr/local/lib/python3.10/dist-packages (from langchain-core<0.4.0,>=0.3.21->langchain_community) (24.2)\n","Requirement already satisfied: httpx<1,>=0.23.0 in /usr/local/lib/python3.10/dist-packages (from langsmith<0.2.0,>=0.1.125->langchain_community) (0.28.0)\n","Requirement already satisfied: orjson<4.0.0,>=3.9.14 in /usr/local/lib/python3.10/dist-packages (from langsmith<0.2.0,>=0.1.125->langchain_community) (3.10.12)\n","Requirement already satisfied: requests-toolbelt<2.0.0,>=1.0.0 in /usr/local/lib/python3.10/dist-packages (from langsmith<0.2.0,>=0.1.125->langchain_community) (1.0.0)\n","Requirement already satisfied: anyio<5,>=3.5.0 in /usr/local/lib/python3.10/dist-packages (from openai<2.0.0,>=1.54.0->langchain_openai) (3.7.1)\n","Requirement already satisfied: distro<2,>=1.7.0 in /usr/local/lib/python3.10/dist-packages (from openai<2.0.0,>=1.54.0->langchain_openai) (1.9.0)\n","Requirement already satisfied: jiter<1,>=0.4.0 in /usr/local/lib/python3.10/dist-packages (from openai<2.0.0,>=1.54.0->langchain_openai) (0.8.0)\n","Requirement already satisfied: sniffio in /usr/local/lib/python3.10/dist-packages (from openai<2.0.0,>=1.54.0->langchain_openai) (1.3.1)\n","Requirement already satisfied: certifi>=2019.11.17 in /usr/local/lib/python3.10/dist-packages (from pinecone-client<6.0.0,>=5.0.0->langchain_pinecone) (2024.8.30)\n","Collecting pinecone-plugin-inference<2.0.0,>=1.0.3 (from pinecone-client<6.0.0,>=5.0.0->langchain_pinecone)\n","  Downloading pinecone_plugin_inference-1.1.0-py3-none-any.whl.metadata (2.2 kB)\n","Collecting pinecone-plugin-interface<0.0.8,>=0.0.7 (from pinecone-client<6.0.0,>=5.0.0->langchain_pinecone)\n","  Downloading pinecone_plugin_interface-0.0.7-py3-none-any.whl.metadata (1.2 kB)\n","Requirement already satisfied: urllib3>=1.26.0 in /usr/local/lib/python3.10/dist-packages (from pinecone-client<6.0.0,>=5.0.0->langchain_pinecone) (2.2.3)\n","Collecting python-dotenv>=0.21.0 (from pydantic-settings<3.0.0,>=2.4.0->langchain_community)\n","  Downloading python_dotenv-1.0.1-py3-none-any.whl.metadata (23 kB)\n","Requirement already satisfied: charset-normalizer<4,>=2 in /usr/local/lib/python3.10/dist-packages (from requests<3,>=2->langchain_community) (3.4.0)\n","Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests<3,>=2->langchain_community) (3.10)\n","Requirement already satisfied: greenlet!=0.4.17 in /usr/local/lib/python3.10/dist-packages (from SQLAlchemy<3,>=1.4->langchain_community) (3.1.1)\n","Requirement already satisfied: regex>=2022.1.18 in /usr/local/lib/python3.10/dist-packages (from tiktoken<1,>=0.7->langchain_openai) (2024.9.11)\n","Requirement already satisfied: soupsieve>1.2 in /usr/local/lib/python3.10/dist-packages (from beautifulsoup4->unstructured) (2.6)\n","Requirement already satisfied: six>=1.9 in /usr/local/lib/python3.10/dist-packages (from html5lib->unstructured) (1.16.0)\n","Requirement already satisfied: webencodings in /usr/local/lib/python3.10/dist-packages (from html5lib->unstructured) (0.5.1)\n","Requirement already satisfied: click in /usr/local/lib/python3.10/dist-packages (from nltk->unstructured) (8.1.7)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.10/dist-packages (from nltk->unstructured) (1.4.2)\n","Collecting olefile (from python-oxmsg->unstructured)\n","  Downloading olefile-0.47-py2.py3-none-any.whl.metadata (9.7 kB)\n","Collecting aiofiles>=24.1.0 (from unstructured-client->unstructured)\n","  Downloading aiofiles-24.1.0-py3-none-any.whl.metadata (10 kB)\n","Requirement already satisfied: cryptography>=3.1 in /usr/local/lib/python3.10/dist-packages (from unstructured-client->unstructured) (43.0.3)\n","Requirement already satisfied: eval-type-backport<0.3.0,>=0.2.0 in /usr/local/lib/python3.10/dist-packages (from unstructured-client->unstructured) (0.2.0)\n","Collecting jsonpath-python<2.0.0,>=1.0.6 (from unstructured-client->unstructured)\n","  Downloading jsonpath_python-1.0.6-py3-none-any.whl.metadata (12 kB)\n","Requirement already satisfied: nest-asyncio>=1.6.0 in /usr/local/lib/python3.10/dist-packages (from unstructured-client->unstructured) (1.6.0)\n","Collecting pydantic<3.0.0,>=2.7.4 (from langchain<0.4.0,>=0.3.8->langchain_community)\n","  Downloading pydantic-2.9.2-py3-none-any.whl.metadata (149 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m149.4/149.4 kB\u001b[0m \u001b[31m2.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting pypdf>=4.0 (from unstructured-client->unstructured)\n","  Downloading pypdf-5.1.0-py3-none-any.whl.metadata (7.2 kB)\n","Requirement already satisfied: python-dateutil<3.0.0,>=2.8.2 in /usr/local/lib/python3.10/dist-packages (from unstructured-client->unstructured) (2.8.2)\n","Requirement already satisfied: exceptiongroup in /usr/local/lib/python3.10/dist-packages (from anyio<5,>=3.5.0->openai<2.0.0,>=1.54.0->langchain_openai) (1.2.2)\n","Requirement already satisfied: cffi>=1.12 in /usr/local/lib/python3.10/dist-packages (from cryptography>=3.1->unstructured-client->unstructured) (1.17.1)\n","Requirement already satisfied: httpcore==1.* in /usr/local/lib/python3.10/dist-packages (from httpx<1,>=0.23.0->langsmith<0.2.0,>=0.1.125->langchain_community) (1.0.7)\n","Requirement already satisfied: h11<0.15,>=0.13 in /usr/local/lib/python3.10/dist-packages (from httpcore==1.*->httpx<1,>=0.23.0->langsmith<0.2.0,>=0.1.125->langchain_community) (0.14.0)\n","Requirement already satisfied: jsonpointer>=1.9 in /usr/local/lib/python3.10/dist-packages (from jsonpatch<2.0,>=1.33->langchain-core<0.4.0,>=0.3.21->langchain_community) (3.0.0)\n","Requirement already satisfied: annotated-types>=0.6.0 in /usr/local/lib/python3.10/dist-packages (from pydantic<3.0.0,>=2.7.4->langchain<0.4.0,>=0.3.8->langchain_community) (0.7.0)\n","Collecting pydantic-core==2.23.4 (from pydantic<3.0.0,>=2.7.4->langchain<0.4.0,>=0.3.8->langchain_community)\n","  Downloading pydantic_core-2.23.4-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (6.6 kB)\n","Collecting mypy-extensions>=0.3.0 (from typing-inspect<1,>=0.4.0->dataclasses-json<0.7,>=0.5.7->langchain_community)\n","  Downloading mypy_extensions-1.0.0-py3-none-any.whl.metadata (1.1 kB)\n","Requirement already satisfied: propcache>=0.2.0 in /usr/local/lib/python3.10/dist-packages (from yarl<2.0,>=1.0->aiohttp<4.0.0,>=3.8.3->langchain_community) (0.2.1)\n","Requirement already satisfied: pycparser in /usr/local/lib/python3.10/dist-packages (from cffi>=1.12->cryptography>=3.1->unstructured-client->unstructured) (2.22)\n","Downloading langchain_community-0.3.9-py3-none-any.whl (2.4 MB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m2.4/2.4 MB\u001b[0m \u001b[31m4.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading langchain_pinecone-0.2.0-py3-none-any.whl (11 kB)\n","Downloading langchain_openai-0.2.11-py3-none-any.whl (50 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m50.7/50.7 kB\u001b[0m \u001b[31m3.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading unstructured-0.16.9-py3-none-any.whl (1.7 MB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m1.7/1.7 MB\u001b[0m \u001b[31m6.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading aiohttp-3.9.5-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (1.2 MB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m1.2/1.2 MB\u001b[0m \u001b[31m7.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading dataclasses_json-0.6.7-py3-none-any.whl (28 kB)\n","Downloading httpx_sse-0.4.0-py3-none-any.whl (7.8 kB)\n","Downloading pinecone_client-5.0.1-py3-none-any.whl (244 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m244.8/244.8 kB\u001b[0m \u001b[31m5.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading pydantic_settings-2.6.1-py3-none-any.whl (28 kB)\n","Downloading tiktoken-0.8.0-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (1.2 MB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m1.2/1.2 MB\u001b[0m \u001b[31m7.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading backoff-2.2.1-py3-none-any.whl (15 kB)\n","Downloading emoji-2.14.0-py3-none-any.whl (586 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m586.9/586.9 kB\u001b[0m \u001b[31m7.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading filetype-1.2.0-py2.py3-none-any.whl (19 kB)\n","Downloading python_iso639-2024.10.22-py3-none-any.whl (274 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m274.9/274.9 kB\u001b[0m \u001b[31m5.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading python_magic-0.4.27-py2.py3-none-any.whl (13 kB)\n","Downloading python_oxmsg-0.0.1-py3-none-any.whl (31 kB)\n","Downloading rapidfuzz-3.10.1-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (3.1 MB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m3.1/3.1 MB\u001b[0m \u001b[31m9.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading unstructured_client-0.28.1-py3-none-any.whl (62 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m62.9/62.9 kB\u001b[0m \u001b[31m4.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading aiofiles-24.1.0-py3-none-any.whl (15 kB)\n","Downloading jsonpath_python-1.0.6-py3-none-any.whl (7.6 kB)\n","Downloading marshmallow-3.23.1-py3-none-any.whl (49 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m49.5/49.5 kB\u001b[0m \u001b[31m3.4 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading pinecone_plugin_inference-1.1.0-py3-none-any.whl (85 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m85.4/85.4 kB\u001b[0m \u001b[31m6.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading pinecone_plugin_interface-0.0.7-py3-none-any.whl (6.2 kB)\n","Downloading pydantic-2.9.2-py3-none-any.whl (434 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m434.9/434.9 kB\u001b[0m \u001b[31m8.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading pydantic_core-2.23.4-cp310-cp310-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (2.1 MB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m2.1/2.1 MB\u001b[0m \u001b[31m10.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading pypdf-5.1.0-py3-none-any.whl (297 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m298.0/298.0 kB\u001b[0m \u001b[31m8.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading python_dotenv-1.0.1-py3-none-any.whl (19 kB)\n","Downloading typing_inspect-0.9.0-py3-none-any.whl (8.8 kB)\n","Downloading olefile-0.47-py2.py3-none-any.whl (114 kB)\n","\u001b[2K   \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m114.6/114.6 kB\u001b[0m \u001b[31m7.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hDownloading mypy_extensions-1.0.0-py3-none-any.whl (4.7 kB)\n","Building wheels for collected packages: langdetect\n","  Building wheel for langdetect (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for langdetect: filename=langdetect-1.0.9-py3-none-any.whl size=993222 sha256=632711fd595b3d1fd93ae57f34637ed49ad3f736b3813e70990b9ce1ad9e18ce\n","  Stored in directory: /root/.cache/pip/wheels/95/03/7d/59ea870c70ce4e5a370638b5462a7711ab78fba2f655d05106\n","Successfully built langdetect\n","Installing collected packages: filetype, rapidfuzz, python-magic, python-iso639, python-dotenv, pypdf, pydantic-core, pinecone-plugin-interface, olefile, mypy-extensions, marshmallow, langdetect, jsonpath-python, httpx-sse, emoji, backoff, aiofiles, typing-inspect, tiktoken, python-oxmsg, pydantic, pinecone-plugin-inference, unstructured-client, pydantic-settings, pinecone-client, dataclasses-json, aiohttp, unstructured, langchain_pinecone, langchain_openai, langchain_community\n","  Attempting uninstall: pydantic-core\n","    Found existing installation: pydantic_core 2.27.1\n","    Uninstalling pydantic_core-2.27.1:\n","      Successfully uninstalled pydantic_core-2.27.1\n","  Attempting uninstall: pydantic\n","    Found existing installation: pydantic 2.10.2\n","    Uninstalling pydantic-2.10.2:\n","      Successfully uninstalled pydantic-2.10.2\n","  Attempting uninstall: aiohttp\n","    Found existing installation: aiohttp 3.11.9\n","    Uninstalling aiohttp-3.11.9:\n","      Successfully uninstalled aiohttp-3.11.9\n","Successfully installed aiofiles-24.1.0 aiohttp-3.9.5 backoff-2.2.1 dataclasses-json-0.6.7 emoji-2.14.0 filetype-1.2.0 httpx-sse-0.4.0 jsonpath-python-1.0.6 langchain_community-0.3.9 langchain_openai-0.2.11 langchain_pinecone-0.2.0 langdetect-1.0.9 marshmallow-3.23.1 mypy-extensions-1.0.0 olefile-0.47 pinecone-client-5.0.1 pinecone-plugin-inference-1.1.0 pinecone-plugin-interface-0.0.7 pydantic-2.9.2 pydantic-core-2.23.4 pydantic-settings-2.6.1 pypdf-5.1.0 python-dotenv-1.0.1 python-iso639-2024.10.22 python-magic-0.4.27 python-oxmsg-0.0.1 rapidfuzz-3.10.1 tiktoken-0.8.0 typing-inspect-0.9.0 unstructured-0.16.9 unstructured-client-0.28.1\n"]}],"source":["! pip install \\\n","  langchain_community \\\n","  langchain_pinecone \\\n","  langchain_openai \\\n","  unstructured \\\n","  langchain-text-splitters\n"]},{"cell_type":"code","source":["!pip install --upgrade pinecone-client"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"P2G_krJJjEoy","executionInfo":{"status":"ok","timestamp":1733475906265,"user_tz":-540,"elapsed":7512,"user":{"displayName":"_강니","userId":"10023388957614741272"}},"outputId":"c62e65d9-bead-4a8a-c693-66c55b1f08be"},"execution_count":13,"outputs":[{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: pinecone-client in /usr/local/lib/python3.10/dist-packages (5.0.1)\n","Requirement already satisfied: certifi>=2019.11.17 in /usr/local/lib/python3.10/dist-packages (from pinecone-client) (2024.8.30)\n","Requirement already satisfied: pinecone-plugin-inference<2.0.0,>=1.0.3 in /usr/local/lib/python3.10/dist-packages (from pinecone-client) (1.1.0)\n","Requirement already satisfied: pinecone-plugin-interface<0.0.8,>=0.0.7 in /usr/local/lib/python3.10/dist-packages (from pinecone-client) (0.0.7)\n","Requirement already satisfied: tqdm>=4.64.1 in /usr/local/lib/python3.10/dist-packages (from pinecone-client) (4.66.6)\n","Requirement already satisfied: typing-extensions>=3.7.4 in /usr/local/lib/python3.10/dist-packages (from pinecone-client) (4.12.2)\n","Requirement already satisfied: urllib3>=1.26.0 in /usr/local/lib/python3.10/dist-packages (from pinecone-client) (2.2.3)\n"]}]},{"cell_type":"code","execution_count":14,"metadata":{"id":"90N0vkZL6H6G","executionInfo":{"status":"ok","timestamp":1733475908406,"user_tz":-540,"elapsed":2149,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"outputs":[],"source":["from langchain_pinecone import PineconeVectorStore\n","from langchain_openai import OpenAIEmbeddings\n","from langchain_community.document_loaders import DirectoryLoader\n","from langchain_text_splitters import RecursiveCharacterTextSplitter\n","from langchain.document_loaders import DirectoryLoader, CSVLoader\n","from langchain.schema import Document\n","import openai\n","import pinecone\n","import os\n","import glob"]},{"cell_type":"code","source":["from pinecone import Pinecone, Index"],"metadata":{"id":"8zLHoInpjpR4","executionInfo":{"status":"ok","timestamp":1733475908406,"user_tz":-540,"elapsed":5,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":15,"outputs":[]},{"cell_type":"code","execution_count":16,"metadata":{"id":"GeCKF7U3DQpj","executionInfo":{"status":"ok","timestamp":1733475910193,"user_tz":-540,"elapsed":1791,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"outputs":[],"source":["from google.colab import userdata\n","# api key\n","os.environ['OPENAI_API_KEY'] = userdata.get('OPENAI_API_KEY')\n","os.environ['PINECONE_API_KEY'] = userdata.get('PINECONE_API_KEY')\n","# 환경설정\n","os.environ['PINECONE_ENV'] = \"us-east-1\""]},{"cell_type":"code","source":["# Pinecone 초기화\n","pinecone = Pinecone(\n","    api_key=os.getenv('PINECONE_API_KEY'),  # 환경 변수에서 API 키 가져오기\n","    environment=os.getenv('PINECONE_ENV')  # 환경 변수에서 환경 정보 가져오기\n",")\n","print(\"Pinecone 초기화 완료!\")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"ZGRPXOnij30q","executionInfo":{"status":"ok","timestamp":1733475910193,"user_tz":-540,"elapsed":6,"user":{"displayName":"_강니","userId":"10023388957614741272"}},"outputId":"60c3f217-08ad-4e61-fed2-69098fd9512f"},"execution_count":17,"outputs":[{"output_type":"stream","name":"stdout","text":["Pinecone 초기화 완료!\n"]}]},{"cell_type":"code","source":["import os\n","print(\"PINECONE_API_KEY:\", os.getenv('PINECONE_API_KEY'))  # API 키 출력\n","print(\"PINECONE_ENV:\", os.getenv('PINECONE_ENV'))  # 환경 정보 출력\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"vj5lilj5mm5L","executionInfo":{"status":"ok","timestamp":1733475910193,"user_tz":-540,"elapsed":5,"user":{"displayName":"_강니","userId":"10023388957614741272"}},"outputId":"aacda30b-a27a-479c-95df-75f8764942e0"},"execution_count":18,"outputs":[{"output_type":"stream","name":"stdout","text":["PINECONE_API_KEY: pcsk_2Ue3HL_2ZJyYY8bweUkSRXCcEYgchQsqXsmteP4e6LzrtWiEyhTTFHnjSRSTS4Yf7N29DD\n","PINECONE_ENV: us-east-1\n"]}]},{"cell_type":"code","source":["# index_name = \"tamtam\"\n","\n","# # 기존 인덱스 확인\n","# if index_name not in pinecone.list_indexes():\n","#     raise ValueError(f\"'{index_name}' 인덱스가 존재하지 않습니다. Pinecone 대시보드에서 확인하세요.\")\n","\n","# # 기존 인덱스 객체 생성\n","# index = Index(name=index_name, pinecone=pinecone)\n","# print(f\"'{index_name}' 인덱스를 성공적으로 참조했습니다!\")\n"],"metadata":{"id":"J8vwSP9mk5P3","executionInfo":{"status":"ok","timestamp":1733475910193,"user_tz":-540,"elapsed":3,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":19,"outputs":[]},{"cell_type":"code","execution_count":20,"metadata":{"id":"Tkh-3xPuDjsr","colab":{"base_uri":"https://localhost:8080/","height":388},"executionInfo":{"status":"error","timestamp":1733475910929,"user_tz":-540,"elapsed":739,"user":{"displayName":"_강니","userId":"10023388957614741272"}},"outputId":"9141d926-8665-4c05-f850-c26b85447adf"},"outputs":[{"output_type":"error","ename":"TypeError","evalue":"Client.__init__() got an unexpected keyword argument 'proxies'","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mTypeError\u001b[0m                                 Traceback (most recent call last)","\u001b[0;32m<ipython-input-20-769d4c3fc5eb>\u001b[0m in \u001b[0;36m<cell line: 1>\u001b[0;34m()\u001b[0m\n\u001b[0;32m----> 1\u001b[0;31m embeddings = OpenAIEmbeddings(\n\u001b[0m\u001b[1;32m      2\u001b[0m     \u001b[0mmodel\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;34m\"text-embedding-ada-002\"\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      3\u001b[0m     )\n\u001b[1;32m      4\u001b[0m \u001b[0mindex_name\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m\"tamtam\"\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","    \u001b[0;31m[... skipping hidden 1 frame]\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.10/dist-packages/langchain_openai/embeddings/base.py\u001b[0m in \u001b[0;36mvalidate_environment\u001b[0;34m(self)\u001b[0m\n\u001b[1;32m    336\u001b[0m                 \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mhttp_client\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mhttpx\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mClient\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mproxy\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mopenai_proxy\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    337\u001b[0m             \u001b[0msync_specific\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34m{\u001b[0m\u001b[0;34m\"http_client\"\u001b[0m\u001b[0;34m:\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mhttp_client\u001b[0m\u001b[0;34m}\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 338\u001b[0;31m             \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mclient\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mopenai\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mOpenAI\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m**\u001b[0m\u001b[0mclient_params\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;34m**\u001b[0m\u001b[0msync_specific\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0membeddings\u001b[0m  \u001b[0;31m# type: ignore[arg-type]\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    339\u001b[0m         \u001b[0;32mif\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0masync_client\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    340\u001b[0m             \u001b[0;32mif\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mopenai_proxy\u001b[0m \u001b[0;32mand\u001b[0m \u001b[0;32mnot\u001b[0m \u001b[0mself\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mhttp_async_client\u001b[0m\u001b[0;34m:\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.10/dist-packages/openai/_client.py\u001b[0m in \u001b[0;36m__init__\u001b[0;34m(self, api_key, organization, project, base_url, timeout, max_retries, default_headers, default_query, http_client, _strict_response_validation)\u001b[0m\n\u001b[1;32m    121\u001b[0m             \u001b[0mbase_url\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;34mf\"https://api.openai.com/v1\"\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    122\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 123\u001b[0;31m         super().__init__(\n\u001b[0m\u001b[1;32m    124\u001b[0m             \u001b[0mversion\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0m__version__\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    125\u001b[0m             \u001b[0mbase_url\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mbase_url\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.10/dist-packages/openai/_base_client.py\u001b[0m in \u001b[0;36m__init__\u001b[0;34m(self, version, base_url, max_retries, timeout, transport, proxies, limits, http_client, custom_headers, custom_query, _strict_response_validation)\u001b[0m\n\u001b[1;32m    855\u001b[0m             \u001b[0m_strict_response_validation\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0m_strict_response_validation\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    856\u001b[0m         )\n\u001b[0;32m--> 857\u001b[0;31m         self._client = http_client or SyncHttpxClientWrapper(\n\u001b[0m\u001b[1;32m    858\u001b[0m             \u001b[0mbase_url\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0mbase_url\u001b[0m\u001b[0;34m,\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    859\u001b[0m             \u001b[0;31m# cast to a valid type because mypy doesn't understand our type narrowing\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;32m/usr/local/lib/python3.10/dist-packages/openai/_base_client.py\u001b[0m in \u001b[0;36m__init__\u001b[0;34m(self, **kwargs)\u001b[0m\n\u001b[1;32m    753\u001b[0m         \u001b[0mkwargs\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msetdefault\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"limits\"\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mDEFAULT_CONNECTION_LIMITS\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    754\u001b[0m         \u001b[0mkwargs\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0msetdefault\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m\"follow_redirects\"\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0;32mTrue\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m--> 755\u001b[0;31m         \u001b[0msuper\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0m__init__\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m**\u001b[0m\u001b[0mkwargs\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m    756\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m    757\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mTypeError\u001b[0m: Client.__init__() got an unexpected keyword argument 'proxies'"]}],"source":["embeddings = OpenAIEmbeddings(\n","    model=\"text-embedding-ada-002\"\n","    )\n","index_name = \"tamtam\""]},{"cell_type":"code","source":["# Pinecone 상태 확인\n","print(pinecone.list_indexes())  # 사용 가능한 인덱스 목록 출력\n"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"h5WEVmdykfCK","executionInfo":{"status":"ok","timestamp":1733475919489,"user_tz":-540,"elapsed":663,"user":{"displayName":"_강니","userId":"10023388957614741272"}},"outputId":"f5a733e5-0b12-4006-cad1-c7af7d1509d1"},"execution_count":21,"outputs":[{"output_type":"stream","name":"stdout","text":["{'indexes': [{'deletion_protection': 'disabled',\n","              'dimension': 384,\n","              'host': 'restaurants-p6kt93f.svc.aped-4627-b74a.pinecone.io',\n","              'metric': 'cosine',\n","              'name': 'restaurants',\n","              'spec': {'serverless': {'cloud': 'aws', 'region': 'us-east-1'}},\n","              'status': {'ready': True, 'state': 'Ready'}},\n","             {'deletion_protection': 'disabled',\n","              'dimension': 384,\n","              'host': 'tamtam2-p6kt93f.svc.aped-4627-b74a.pinecone.io',\n","              'metric': 'cosine',\n","              'name': 'tamtam2',\n","              'spec': {'serverless': {'cloud': 'aws', 'region': 'us-east-1'}},\n","              'status': {'ready': True, 'state': 'Ready'}}]}\n"]}]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Sl-OF1kE43g9","executionInfo":{"status":"aborted","timestamp":1733475910930,"user_tz":-540,"elapsed":13,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"outputs":[],"source":["# 각 질문에 대한 임베딩 생성\n","for record in qa_data:\n","    record[\"embedding\"] = embeddings.embed_query(record[\"question\"])\n"]},{"cell_type":"code","source":["print(qa_data[0])"],"metadata":{"id":"61jwX01fgfHM","executionInfo":{"status":"aborted","timestamp":1733475910930,"user_tz":-540,"elapsed":13,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"id":"R4xh_MQRfbcq","executionInfo":{"status":"aborted","timestamp":1733475910930,"user_tz":-540,"elapsed":13,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"outputs":[],"source":["# qa_data"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"omEzzyINDfNC","executionInfo":{"status":"aborted","timestamp":1733475910930,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"outputs":[],"source":["text_splitter = RecursiveCharacterTextSplitter(\n","    chunk_size = 1000, ## 청크 최대 길이\n","    chunk_overlap  = 0, ## 겹치는 정도 0 긴 문서나 연속적인 내용이 아님\n","    length_function = len, ## 텍스트 길이 측정\n",")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"NojqEAtgFG5x","executionInfo":{"status":"aborted","timestamp":1733475910930,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"outputs":[],"source":["# split_docs = text_splitter.split_documents(documents)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ak9RAGHdGVQy","executionInfo":{"status":"aborted","timestamp":1733475910931,"user_tz":-540,"elapsed":13,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"outputs":[],"source":["## 이미 데이터 db에 넣었으므로 다시 실행하지 않아도 됨\n","# batch_size = 20\n","# batched_docs = [split_docs[i:i + batch_size] for i in range(0, len(split_docs), batch_size)]\n","\n","# for batch in batched_docs:\n","#     vectorstore = PineconeVectorStore.from_documents(\n","#         documents=batch,\n","#         embedding=embeddings,\n","#         index_name=index_name\n","#     )\n"]},{"cell_type":"code","source":["# Pinecone 인덱스 객체 생성\n","index = pinecone.Index(index_name)\n","print(f\"Pinecone 인덱스 '{index_name}' 준비 완료!\")"],"metadata":{"id":"hYfUGFtJi4sw","executionInfo":{"status":"aborted","timestamp":1733475910931,"user_tz":-540,"elapsed":13,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# import json\n","\n","# # Pinecone에 모든 데이터 업로드\n","# for record in qa_data:\n","#     # ASCII 기반 ID 생성\n","#     record[\"id\"] = str(abs(hash(record[\"question\"])))\n","\n","#     # Pinecone에 데이터 업로드\n","#     index.upsert([\n","#         {\n","#             \"id\": record[\"id\"],  # ASCII 형식의 벡터 ID\n","#             \"values\": record[\"embedding\"],  # 벡터 값\n","#             \"metadata\": {\n","#                 \"question\": record[\"question\"],\n","#                 \"theme\": record[\"theme\"],\n","#                 \"location\": record[\"location\"],\n","#                 # JSON 문자열로 변환\n","#                 \"restaurants\": json.dumps(record[\"restaurants\"], ensure_ascii=False)\n","#             }\n","#         }\n","#     ])\n","# print(\"Pinecone에 모든 데이터 업로드 완료!\")\n"],"metadata":{"id":"exKvgKgfgsTI","executionInfo":{"status":"aborted","timestamp":1733475910931,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":12,"status":"aborted","timestamp":1733475910931,"user":{"displayName":"_강니","userId":"10023388957614741272"},"user_tz":-540},"id":"YSmYNZnwZGNo"},"outputs":[],"source":["# 이미 저장된 Pinecone 인덱스를 로드하여 vectorstore 생성\n","vectorstore = PineconeVectorStore(\n","    index_name=index_name,\n","    embedding=embeddings\n",")\n","\n","# 검색 쿼리 예시\n","query = \"제주도에서 갈치 요리를 파는 음식점\"\n","similar_docs = vectorstore.similarity_search(query)\n","\n","# 검색 결과 출력\n","for doc in similar_docs:\n","    print(doc.page_content)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":12,"status":"aborted","timestamp":1733475910931,"user":{"displayName":"_강니","userId":"10023388957614741272"},"user_tz":-540},"id":"4cT_oGI2ZhYy"},"outputs":[],"source":["# 검색 쿼리 예시\n","query = \"제주도 고기국수\"\n","similar_docs = vectorstore.similarity_search(query)\n","\n","# 검색 결과 출력\n","for doc in similar_docs:\n","    print(doc.page_content)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":12,"status":"aborted","timestamp":1733475910931,"user":{"displayName":"_강니","userId":"10023388957614741272"},"user_tz":-540},"id":"Z3biWjCEZnKp"},"outputs":[],"source":["# 검색 쿼리 예시\n","query = \"제주도 카페 맛집\"\n","similar_docs = vectorstore.similarity_search(query)\n","\n","# 검색 결과 출력\n","for doc in similar_docs:\n","    print(doc.page_content)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"BS6tMOegHnfK","executionInfo":{"status":"aborted","timestamp":1733475910931,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"outputs":[],"source":["from langchain.chains import RetrievalQA\n","from langchain.chat_models import ChatOpenAI\n","\n","vectorstore = PineconeVectorStore(index_name=\"tamtam\", embedding=embeddings)\n","llm = ChatOpenAI(\n","    model_name=\"gpt-4o-mini\",\n","    temperature=0)\n","qa_chain = RetrievalQA.from_chain_type(\n","    llm = llm,\n","    chain_type=\"stuff\",\n","    retriever=vectorstore.as_retriever())\n"]},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":12,"status":"aborted","timestamp":1733475910931,"user":{"displayName":"_강니","userId":"10023388957614741272"},"user_tz":-540},"id":"bg_q2wWXasr-"},"outputs":[],"source":["query = \"제주도에서 갈치 요리를 제공하는 음식점 이름을 알려줘\"\n","result = qa_chain.run(query)\n","print(result)\n"]},{"cell_type":"code","source":["# 사용자 질문 예제\n","query = \"성산일출봉 근처 맛집 추천\"\n","query_embedding = embeddings.embed_query(query)\n","\n","# Pinecone 검색\n","results = index.query(\n","    vector=query_embedding,\n","    top_k=5,  # 상위 5개 결과 가져오기\n","    include_metadata=True\n",")\n","\n","# 검색 결과 출력\n","for result in results[\"matches\"]:\n","    print(f\"유사도 점수: {result['score']}\")\n","    print(f\"질문: {result['metadata']['question']}\")\n","    print(f\"테마: {result['metadata']['theme']}\")\n","    print(f\"위치: {result['metadata']['location']}\")\n","\n","    # JSON 문자열을 복구하여 레스토랑 정보 출력\n","    restaurants = json.loads(result['metadata']['restaurants'])\n","    for restaurant in restaurants:\n","        print(f\"식당 이름: {restaurant['Restaurant_Name']}, 주소: {restaurant['Address']}\")\n"],"metadata":{"id":"WsHQEwc0r0ui","executionInfo":{"status":"aborted","timestamp":1733475910931,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# 사용자 질문 예제\n","query = \"산방산 근처 맛집 추천\"\n","query_embedding = embeddings.embed_query(query)\n","\n","# Pinecone 검색\n","results = index.query(\n","    vector=query_embedding,\n","    top_k=5,  # 상위 5개 결과 가져오기\n","    include_metadata=True\n",")\n","\n","# 검색 결과 출력\n","for result in results[\"matches\"]:\n","    print(f\"유사도 점수: {result['score']}\")\n","    print(f\"질문: {result['metadata']['question']}\")\n","    print(f\"테마: {result['metadata']['theme']}\")\n","    print(f\"위치: {result['metadata']['location']}\")\n","\n","    # JSON 문자열을 복구하여 레스토랑 정보 출력\n","    restaurants = json.loads(result['metadata']['restaurants'])\n","    for restaurant in restaurants:\n","        print(f\"식당 이름: {restaurant['Restaurant_Name']}, 주소: {restaurant['Address']}\")\n"],"metadata":{"id":"wbigViE2r-5X","executionInfo":{"status":"aborted","timestamp":1733475910932,"user_tz":-540,"elapsed":13,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from langchain.prompts import PromptTemplate\n","from langchain.chains import RetrievalQA\n","\n","\n","# 사용자 정의 프롬프트 생성\n","custom_prompt = PromptTemplate(\n","    input_variables=[\"context\", \"query\"],\n","    template=(\n","        \"다음은 제주도의 관광지 및 관련된 음식점 데이터입니다:\\n\\n{context}\\n\\n\"\n","        \"사용자의 질문은: {query}\\n\"\n","        \"이 질문에 대한 관련 정보를 제공해주세요. 가능하면 모든 관련 식당을 포함하세요.\"\n","    )\n",")\n"],"metadata":{"id":"aM7EerboupfT","executionInfo":{"status":"aborted","timestamp":1733475910932,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from langchain.chains import LLMChain\n","from langchain.prompts import PromptTemplate\n","from langchain.llms import OpenAI\n","\n","# OpenAI 초기화\n","llm = OpenAI(model=\"text-davinci-003\")\n","\n","# 사용자 정의 프롬프트\n","prompt = PromptTemplate(\n","    input_variables=[\"context\", \"query\"],\n","    template=(\n","        \"다음은 문서에서 검색된 정보입니다:\\n\\n{context}\\n\\n\"\n","        \"질문: {query}\\n\"\n","        \"답변:\"\n","    )\n",")\n","\n","# LLM 체인 생성\n","qa_chain = LLMChain(llm=llm, prompt=prompt)\n"],"metadata":{"id":"Zb50Fy-gu-vx","executionInfo":{"status":"aborted","timestamp":1733475910932,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["query = \"산방산 근처 식당 3개 알려줘\"\n","result = qa_chain.run(query)\n","print(result)\n"],"metadata":{"id":"w3rjCBxFthQ4","executionInfo":{"status":"aborted","timestamp":1733475910932,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["query = \"만장굴 근처 식당 여러개 알려줘\"\n","result = qa_chain.run(query)\n","print(result)"],"metadata":{"id":"43E53WK5v0KI","executionInfo":{"status":"aborted","timestamp":1733475910932,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["query = \"왜 만장굴 근처 식당 여러개 알려줄수 없니?\"\n","result = qa_chain.run(query)\n","print(result)"],"metadata":{"id":"NRdI32Vov58F","executionInfo":{"status":"aborted","timestamp":1733475910932,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["query = \"제주도 2박3일 여행일정 추천해줘\"\n","result = qa_chain.run(query)\n","print(result)"],"metadata":{"id":"0cXo_qJ8wEDJ","executionInfo":{"status":"aborted","timestamp":1733475910932,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# 사용자 질문 예제\n","query = \"애월 근처 맛집\"\n","query_embedding = embeddings.embed_query(query)\n","\n","# Pinecone 검색\n","results = index.query(\n","    vector=query_embedding,\n","    top_k=5,  # 상위 5개 결과 가져오기\n","    include_metadata=True\n",")\n","\n","# 검색 결과 출력\n","for result in results[\"matches\"]:\n","    print(f\"유사도 점수: {result['score']}\")\n","    print(f\"질문: {result['metadata']['question']}\")\n","    print(f\"테마: {result['metadata']['theme']}\")\n","    print(f\"위치: {result['metadata']['location']}\")\n","\n","    # JSON 문자열을 복구하여 레스토랑 정보 출력\n","    restaurants = json.loads(result['metadata']['restaurants'])\n","    for restaurant in restaurants:\n","        print(f\"식당 이름: {restaurant['Restaurant_Name']}, 주소: {restaurant['Address']}\")\n"],"metadata":{"id":"rQCRoqYXuLH-","executionInfo":{"status":"aborted","timestamp":1733475910932,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# 사용자 질문 예제\n","query = \"공항 근처 맛집\"\n","query_embedding = embeddings.embed_query(query)\n","\n","# Pinecone 검색\n","results = index.query(\n","    vector=query_embedding,\n","    top_k=5,  # 상위 5개 결과 가져오기\n","    include_metadata=True\n",")\n","\n","# 검색 결과 출력\n","for result in results[\"matches\"]:\n","    print(f\"유사도 점수: {result['score']}\")\n","    print(f\"질문: {result['metadata']['question']}\")\n","    print(f\"테마: {result['metadata']['theme']}\")\n","    print(f\"위치: {result['metadata']['location']}\")\n","\n","    # JSON 문자열을 복구하여 레스토랑 정보 출력\n","    restaurants = json.loads(result['metadata']['restaurants'])\n","    for restaurant in restaurants:\n","        print(f\"식당 이름: {restaurant['Restaurant_Name']}, 주소: {restaurant['Address']}\")\n"],"metadata":{"id":"g0vzARcnuYYm","executionInfo":{"status":"aborted","timestamp":1733475910932,"user_tz":-540,"elapsed":11,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["## 질문 셋 추가 생성"],"metadata":{"id":"Ouhzlx_YzqkD"}},{"cell_type":"code","source":["themes = [\"자연\", \"액티비티\", \"쇼핑\", \"여유로운 힐링\", \"문화/예술/역사\", \"먹방\"]\n","companions = [\"혼자\", \"친구와\", \"부모님과\", \"연인과\", \"아이와\"]\n","durations = [\"하루\", \"2박 3일\", \"3박 4일\", \"1주\", \"당일치기\",\"4박 5일\",\"5박 6일\"]\n","\n","questions = []\n","\n","# 조합 생성\n","for theme in themes:\n","    for companion in companions:\n","        for duration in durations:\n","            questions.append(f\"{theme} 테마로 {companion} 함께 {duration} 동안 여행하려면 어디를 방문하면 좋을까요?\")\n","            questions.append(f\"{theme} 테마로 {companion} 갈만한 제주도 관광지와 맛집을 추천해주세요.\")\n","            questions.append(f\"제주도에서 {duration} 동안 {theme} 테마를 즐기려면 {companion} 어떤 장소가 좋을까요?\")\n"],"metadata":{"id":"gcOTkyzkztOy","executionInfo":{"status":"aborted","timestamp":1733475910932,"user_tz":-540,"elapsed":11,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["import json\n","\n","# JSON 파일로 저장\n","with open(\"questions.json\", \"w\", encoding=\"utf-8\") as f:\n","    json.dump(questions, f, ensure_ascii=False, indent=4)\n","print(\"질문 세트 저장 완료!\")\n"],"metadata":{"id":"QXm-GLz_z9G3","executionInfo":{"status":"aborted","timestamp":1733475910932,"user_tz":-540,"elapsed":11,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# JSON 질문 세트 로드\n","with open(\"questions.json\", \"r\", encoding=\"utf-8\") as f:\n","    questions = json.load(f)\n","\n","print(f\"{len(questions)}개의 질문 로드 완료!\")"],"metadata":{"id":"vGpI4r_d0GJS","executionInfo":{"status":"aborted","timestamp":1733475910932,"user_tz":-540,"elapsed":11,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# # Pinecone에 질문 업로드\n","# for question in questions:\n","#     question_embedding = embeddings.embed_query(question)\n","\n","#     # Pinecone에 저장\n","#     index.upsert([\n","#         {\n","#             \"id\": str(abs(hash(question))),  # 질문 해시값을 ASCII ID로 사용\n","#             \"values\": question_embedding,  # 질문 벡터\n","#             \"metadata\": {\n","#                 \"text\": question  # 질문 텍스트 저장\n","#             }\n","#         }\n","#     ])\n","\n","# print(\"모든 질문이 Pinecone에 업로드 완료되었습니다!\")"],"metadata":{"id":"uyf7IS1k0KCS","executionInfo":{"status":"aborted","timestamp":1733475910932,"user_tz":-540,"elapsed":11,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["query = \"부모님과 제주도 2박3일 여행일정 추천해줘\"\n","result = qa_chain.run(query)\n","print(result)"],"metadata":{"id":"mx30-5hF0MAI","executionInfo":{"status":"aborted","timestamp":1733475910933,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["query = \"올레길 말고 다른데 갈래\"\n","result = qa_chain.run(query)\n","print(result)"],"metadata":{"id":"d3jl_sD-3Vje","executionInfo":{"status":"aborted","timestamp":1733475910933,"user_tz":-540,"elapsed":12,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from langchain.prompts import PromptTemplate\n","\n","# 사용자 정의 프롬프트\n","prompt_template = \"\"\"\n","다음은 제주도 여행 관련 질문과 검색된 결과입니다:\n","\n","질문: {query}\n","\n","검색된 결과:\n","{search_results}\n","\n","사용자의 질문에 가장 적합한 자연스러운 답변을 작성해주세요.\n","\"\"\"\n","\n","# 검색 결과를 텍스트로 변환\n","search_results = \"\"\n","for result in results[\"matches\"]:\n","    search_results += f\"질문: {result['metadata']['text']}\\n\"\n","    theme = result[\"metadata\"].get(\"theme\", \"테마 정보 없음\")\n","    search_results += f\"테마: {theme}\\n\"\n","    theme = result[\"metadata\"].get(\"location\", \"위치 정보 없음\")\n","    search_results += f\"위치: {theme}\\n\"\n","    search_results += \"추천 식당 목록:\\n\"\n","    # restaurants = json.loads(result['metadata']['restaurants'])\n","    for restaurant in restaurants:\n","        search_results += f\"  - {restaurant['Restaurant_Name']} ({restaurant['Address']})\\n\"\n","    search_results += \"\\n\"\n","\n","# 프롬프트 생성\n","prompt = prompt_template.format(query=query, search_results=search_results)\n","\n","# LLM 응답 생성\n","response = llm(prompt)\n","print(response)\n"],"metadata":{"id":"519cqkyn1mgK","executionInfo":{"status":"aborted","timestamp":1733475910933,"user_tz":-540,"elapsed":11,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["# Pinecone에 업로드된 데이터 확인\n","query_embedding = embeddings.embed_query(\"데이터 확인용 임시 질문\")\n","results = index.query(vector=query_embedding, top_k=1, include_metadata=True)\n","\n","# 데이터 출력\n","for result in results[\"matches\"]:\n","    print(result[\"metadata\"])\n"],"metadata":{"id":"2jAmBuM33--M","executionInfo":{"status":"aborted","timestamp":1733475910933,"user_tz":-540,"elapsed":11,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"markdown","source":["# 여기 인덱스 연결 다시 해야함\n","text 필드가 없고 나는 question 필드가 있어서 바꿔줘야 함"],"metadata":{"id":"LzVBNL_54zhM"}},{"cell_type":"code","source":["import pinecone\n","from langchain.embeddings.openai import OpenAIEmbeddings\n","from langchain.vectorstores import Pinecone\n","\n","# Pinecone 초기화\n","pinecone.init(api_key=\"YOUR_PINECONE_API_KEY\", environment=\"YOUR_PINECONE_ENV\")\n","index_name = \"tamtam\"\n","index = pinecone.Index(index_name)\n","\n","# 임베딩 생성\n","embeddings = OpenAIEmbeddings(model=\"text-embedding-ada-002\")\n"],"metadata":{"id":"3HFSJxlo4vyA","executionInfo":{"status":"aborted","timestamp":1733475910933,"user_tz":-540,"elapsed":11,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["ver 설정\n","retriever = Pinecone(\n","    index=index,\n","    embedding_function=embeddings.embed_query,\n","    text_key=\"question\"  # Pinecone 메타데이터에서 'question' 키를 참조\n",")\n"],"metadata":{"id":"AE6Ovv3z4mze","executionInfo":{"status":"aborted","timestamp":1733475910933,"user_tz":-540,"elapsed":11,"user":{"displayName":"_강니","userId":"10023388957614741272"}}},"execution_count":null,"outputs":[]}],"metadata":{"colab":{"provenance":[{"file_id":"1zL9N-wrTUV-aIAbgg0mNwjJPZuc6iWjr","timestamp":1732278235070}],"authorship_tag":"ABX9TyMwMhUqZbZ+byVQrvUZWd8H"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}